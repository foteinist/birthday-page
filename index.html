<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Happy Birthday, Kyriako! ‚ù§Ô∏è</title>
  <link rel="icon" href="favicon.png" type="image/png">
  <script src="https://cdn.jsdelivr.net/npm/js-confetti@latest/dist/js-confetti.browser.js"></script>

  <!-- Preload critical images -->
  <link rel="preload" href="pictures/ffavorite.JPG" as="image">
  <link rel="preload" href="pictures/kiss.JPG" as="image">
  <link rel="preload" href="pictures/loutraki.JPG" as="image">
  <link rel="preload" href="pictures/neamakri.JPG" as="image">
  <link rel="preload" href="pictures/first.JPG" as="image">
  <link rel="preload" href="pictures/kfavorite.JPG" as="image">
  
  <!-- Preload fonts -->
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Playfair+Display:wght@600&family=Dancing+Script:wght@700&display=swap" as="style">
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Playfair+Display:wght@600&family=Dancing+Script:wght@700&display=swap');

    /* Base Theme (Light) */
    :root {
      --primary: #d32f2f;
      --secondary: #282828;
      --accent: #ffcdd2;
      --text: #333;
      --light-bg: #fff9fa;
      --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
      --shadow-md: 0 4px 15px rgba(0,0,0,0.12);
      --shadow-lg: 0 10px 30px rgba(0,0,0,0.15);
      --font-heading: 'Playfair Display', serif;
      --font-body: 'Montserrat', sans-serif;
      --font-special: 'Dancing Script', cursive;
    }

    /* Dark Theme */
    body.dark {
      --primary: #ff6b6b;
      --secondary: #f8f9fa;
      --accent: #343a40;
      --text: #f8f9fa;
      --light-bg: #212529;
    }
    body.dark .glass-panel {
      background: rgba(33, 37, 41, 0.85);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    body.dark .gallery-section,
    body.dark .reasons-widget {
      background: #343a40;
      color: #f8f9fa;
    }
    body.dark .floating-nav {
      background: rgba(52, 58, 64, 0.9);
    }
    body.dark .floating-nav a {
      color: #ff6b6b;
    }

    /* Romantic Theme */
    body.romantic {
      --primary: #ff758c;
      --secondary: #ff7eb3;
      --accent: #ffccd5;
      --text: #5c0032;
      --light-bg: #fff0f3;
    }
    body.romantic .glass-panel {
      background: rgba(255, 240, 243, 0.9);
    }
    body.romantic .memory-card .front {
      background: #ffccd5;
    }
    body.romantic .memory-card .back {
      background: #ffb3c6;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: var(--font-body);
      background: var(--light-bg);
      color: var(--text);
      line-height: 1.6;
      padding: 20px;
      background-image: radial-gradient(var(--accent) 1px, transparent 1px);
      background-size: 20px 20px;
      background-attachment: fixed;
      overflow-x: hidden;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }

    /* Loading Animation */
    .loader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--light-bg);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      transition: opacity 0.5s, visibility 0.5s;
    }

    .heart-pulse {
      font-size: 4rem;
      animation: pulse 1.5s infinite;
      margin-bottom: 20px;
    }

    .progress-ring {
      transform: rotate(-90deg);
    }

    .progress-ring__circle {
      stroke: var(--primary);
      stroke-width: 4;
      fill: transparent;
      stroke-dasharray: 326.56;
      stroke-dashoffset: 326.56;
      animation: progress 2s ease-in-out forwards;
    }

    @keyframes progress {
      to { stroke-dashoffset: 0; }
    }

    @keyframes pulse {
      0% { transform: scale(0.9); opacity: 0.7; }
      50% { transform: scale(1.1); opacity: 1; }
      100% { transform: scale(0.9); opacity: 0.7; }
    }

    /* Typography */
    h1 {
      font-family: var(--font-special);
      font-size: clamp(2.5rem, 6vw, 4rem);
      margin: 20px 0;
      background: linear-gradient(90deg, var(--primary), #f06292);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 2px 2px 8px rgba(0,0,0,0.1);
      min-height: 80px;
      user-select: none;
      letter-spacing: 1px;
      text-align: center;
    }

    h2, h3 {
      font-family: var(--font-heading);
      color: var(--primary);
      margin-top: 1.5rem;
      margin-bottom: 1rem;
      text-align: center;
    }

    /* Confetti Button */
    #confetti-btn {
      background: linear-gradient(135deg, var(--primary), #b71c1c);
      border: none;
      padding: 15px 30px;
      font-size: 1.1rem;
      color: white;
      border-radius: 50px;
      cursor: pointer;
      box-shadow: var(--shadow-md);
      transition: all 0.3s ease;
      letter-spacing: 0.5px;
      margin: 20px auto;
      display: block;
      position: relative;
      overflow: hidden;
    }

    #confetti-btn:hover,
    #confetti-btn:focus {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(211, 47, 47, 0.4);
      outline: none;
    }

    #confetti-btn:focus-visible {
      outline: 3px solid var(--accent);
      outline-offset: 4px;
    }

    #confetti-btn:active {
      transform: translateY(-1px);
    }

    #confetti-btn::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 5px;
      height: 5px;
      background: rgba(255,255,255,0.5);
      opacity: 0;
      border-radius: 100%;
      transform: scale(1, 1) translate(-50%);
      transform-origin: 50% 50%;
    }

    #confetti-btn:focus:not(:active)::after {
      animation: ripple 1s ease-out;
    }

    @keyframes ripple {
      0% {
        transform: scale(0, 0);
        opacity: 0.5;
      }
      100% {
        transform: scale(20, 20);
        opacity: 0;
      }
    }

    /* Navigation */
    .floating-nav {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 50px;
      padding: 10px 20px;
      box-shadow: var(--shadow-md);
      z-index: 100;
    }

    .floating-nav a {
      color: var(--primary);
      text-decoration: none;
      padding: 8px 15px;
      margin: 0 5px;
      border-radius: 20px;
      transition: all 0.3s ease;
      font-weight: 600;
    }

    .floating-nav a:hover {
      background: var(--accent);
    }

    /* Two Column Layout */
    .two-column {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 40px;
      align-items: start;
      margin: 50px auto;
    }

    @media (max-width: 768px) {
      .two-column {
        grid-template-columns: 1fr;
      }
    }

    /* Glass Panel Effect */
    .glass-panel {
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      padding: 30px;
      transition: all 0.5s ease;
    }

    .glass-panel:hover {
      background: rgba(255, 255, 255, 0.95);
      transform: translateY(-5px);
    }

    /* Gallery Section */
    .gallery-section {
      background: white;
      border-radius: 16px;
      padding: 25px;
      box-shadow: var(--shadow-md);
      margin-bottom: 40px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .gallery-section:hover,
    .gallery-section:focus-within {
      transform: translateY(-5px);
      box-shadow: var(--shadow-lg);
    }

    .gallery-container {
      position: relative;
      border-radius: 12px;
      overflow: hidden;
    }

    .gallery {
      display: flex;
      height: 400px;
      max-height: 60vh;
    }

    .gallery img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: none;
      border-radius: 8px;
      transition: transform 0.3s ease;
    }

    .gallery img.active {
      display: block;
      animation: fadeIn 0.5s ease;
    }

    .gallery img.active:hover,
    .gallery img.active:focus {
      transform: scale(1.05);
      outline: none;
    }

    @keyframes fadeIn {
      from { opacity: 0.8; }
      to { opacity: 1; }
    }

    .gallery-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(211, 47, 47, 0.7);
      color: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      font-size: 1.2rem;
      cursor: pointer;
      z-index: 10;
      opacity: 0;
      transition: opacity 0.3s ease, background 0.3s ease;
    }

    .gallery-container:hover .gallery-btn,
    .gallery-btn:focus-visible {
      opacity: 1;
    }

    .gallery-btn:hover,
    .gallery-btn:focus {
      background: var(--primary);
      outline: none;
    }

    .prev-btn { left: 15px; }
    .next-btn { right: 15px; }

    .dots-container {
      display: flex;
      justify-content: center;
      margin-top: 15px;
      gap: 8px;
    }

    .dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #ccc;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .dot.active {
      background: var(--primary);
    }

    /* Spotify Player */
    .music-gift {
      transition: transform 0.3s ease;
    }

    .music-gift:hover,
    .music-gift:focus-within {
      transform: scale(1.02);
    }

    .spotify-container {
      background: var(--secondary);
      border-radius: 16px;
      padding: 20px;
      box-shadow: var(--shadow-md);
    }

    /* Memory Cards */
    .memories {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 25px;
      margin: 50px auto;
      max-width: 800px;
    }

    .memory-card {
      width: 100%;
      aspect-ratio: 1 / 1;
      perspective: 1000px;
      cursor: pointer;
      position: relative;
      transition: transform 0.3s ease;
      outline-offset: 4px;
    }

    .memory-card:hover,
    .memory-card:focus-visible {
      transform: scale(1.03);
      outline: none;
    }

    .memory-card::before {
      content: '';
      position: absolute;
      top: -2px; left: -2px;
      right: -2px; bottom: -2px;
      background: linear-gradient(45deg, 
        #ff0000, #ff7300, #fffb00, #48ff00,
        #00ffd5, #002bff, #7a00ff, #ff00c8);
      background-size: 400%;
      border-radius: 18px;
      z-index: -1;
      opacity: 0;
      transition: 0.5s;
    }

    .memory-card:hover::before {
      opacity: 1;
      animation: gradient-border 8s linear infinite;
    }

    @keyframes gradient-border {
      0% { background-position: 0 0; }
      50% { background-position: 400% 0; }
      100% { background-position: 0 0; }
    }

    .memory-card div {
      width: 100%;
      height: 100%;
      position: absolute;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
      box-shadow: var(--shadow-sm);
      backface-visibility: hidden;
      transition: transform 0.6s ease;
      padding: 15px;
      box-sizing: border-box;
    }

    .front {
      background: #f8bbd0;
      transform: rotateY(0deg);
      font-family: var(--font-heading);
      font-weight: 600;
      font-size: 1.2rem;
      color: #5d001e;
      user-select: none;
    }

    .back {
      background: #e1bee7;
      transform: rotateY(180deg);
      overflow: hidden;
    }

    .back img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      border-radius: 8px;
      display: block;
      margin: auto;
    }

    .memory-card.flipped .front {
      transform: rotateY(180deg);
    }

    .memory-card.flipped .back {
      transform: rotateY(0deg);
    }

    /* Reasons Widget */
    .reasons-widget {
      background: white;
      border-radius: 16px;
      padding: 30px;
      margin: 40px auto;
      max-width: 600px;
      box-shadow: var(--shadow-md);
      text-align: center;
    }

    #reason-generator {
      background: linear-gradient(135deg, var(--primary), #f06292);
      border: 2px solid transparent;
      padding: 12px 28px;
      font-size: 1.1rem;
      font-weight: 600;
      color: white;
      border-radius: 35px;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(211, 47, 47, 0.4);
      letter-spacing: 1.2px;
      transition: 
        background 0.4s ease,
        box-shadow 0.3s ease,
        transform 0.3s ease,
        border-color 0.3s ease;
      user-select: none;
      display: inline-block;
      text-align: center;
      margin-top: 10px;
      position: relative;
      overflow: hidden;
    }

    #reason-generator:hover,
    #reason-generator:focus {
      background: linear-gradient(135deg, #f06292, var(--primary));
      box-shadow: 0 8px 20px rgba(240, 98, 146, 0.6);
      transform: translateY(-3px) scale(1.05);
      outline: none;
      border-color: var(--accent);
    }

    #reason-generator:focus-visible {
      outline: 3px solid var(--accent);
      outline-offset: 4px;
    }

    .reason-card {
      background: var(--accent);
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-style: italic;
      font-family: var(--font-special);
      font-size: 1.4rem;
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.5s ease;
    }

    .reason-card.show {
      opacity: 1;
      transform: translateY(0);
    }

    /* Easter Egg */
    #secret {
      margin: 50px auto 0;
      font-size: 0.8rem;
      color: var(--primary);
      opacity: 0.3;
      cursor: pointer;
      transition: all 0.3s ease;
      display: block;
      text-align: center;
      background: none;
      border: none;
      padding: 10px;
    }

    #secret:hover {
      opacity: 1;
      transform: scale(1.1);
    }

    /* Animations */
    .fade-in {
      opacity: 0;
      transform: translateY(30px);
      animation: fadeInUp 1s ease forwards;
    }

    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .float {
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
    }

    .pulse {
      animation: pulse 2s ease infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.05); opacity: 0.8; }
    }

    /* Particles Background */
    .particles-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }

    .particle {
      position: absolute;
      border-radius: 50%;
      background: hsla(0, 100%, 75%, 0.7);
      animation: floatParticle linear infinite;
      filter: blur(1px);
    }

    @keyframes floatParticle {
      0% {
        transform: translateY(0) rotate(0deg);
        opacity: 0;
      }
      10% {
        opacity: 1;
      }
      90% {
        opacity: 1;
      }
      100% {
        transform: translateY(-100vh) rotate(360deg);
        opacity: 0;
      }
    }

    /* Loading Bar */
    .loading-bar {
      height: 4px;
      background: var(--primary);
      position: fixed;
      top: 0;
      left: 0;
      width: 0%;
      z-index: 9999;
      transition: width 0.3s ease;
    }

    /* Theme Switcher */
    .theme-switcher {
      position: fixed;
      top: 20px;
      right: 20px;
      display: flex;
      gap: 10px;
      z-index: 100;
    }

   .theme-switcher button {
      background: rgba(255,255,255,0.9);
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-sm);
      transition: all 0.3s ease;
    }

    .theme-switcher button:hover {
      transform: scale(1.1);
    }

    /* Smooth scroll */
    html {
      scroll-behavior: smooth;
    }

    [data-scroll] {
      transition: all 1s ease;
      opacity: 0;
      transform: translateY(30px);
    }

    [data-scroll="in"] {
      opacity: 1;
      transform: translateY(0);
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .theme-switcher {
        top: 10px;
        right: 10px;
      }
      
      .floating-nav a {
        padding: 5px 10px;
        font-size: 0.9rem;
      }
      
      .theme-switcher {
        top: 10px;
        right: 10px;
      }
      
      .memory-card {
        max-width: 300px;
        margin: 0 auto;
      }

      /* Add to your <style> section */
      #secret {
        font-family: 'Courier New', monospace;
        background: #1a1a1a;
        color: #00ff00;
        border: 1px solid #3a3a3a;
        border-radius: 0;
        padding: 10px 15px;
        opacity: 0.7;
      }
      #secret:hover {
        opacity: 1;
        text-shadow: 0 0 5px #00ff00;
      }

      input, textarea {
        font-size: 16px; /* Prevents iOS zoom */
      }

      #confetti-btn:active, 
      .memory-card:active {
        transform: scale(0.98);
      }

      @media (hover: none) {
        .gallery-btn { opacity: 1 !important; }
      }

      @media (max-width: 480px) {
        .theme-switcher {
          top: 5px;
          right: 5px;
        }
      }

    }
  </style>
</head>
<body>
  <!-- Loading Animation -->
  <div class="loader">
    <div class="heart-pulse">üíñ</div>
    <svg class="progress-ring" width="120" height="120">
      <circle class="progress-ring__circle" stroke-width="4" fill="transparent" r="52" cx="60" cy="60"/>
    </svg>
  </div>

  <!-- Loading Bar -->
  <div class="loading-bar"></div>

  <!-- Particles Background -->
  <div class="particles-container"></div>

  <!-- Theme Switcher -->
  <div class="theme-switcher">
    <button data-theme="light">‚òÄÔ∏è</button>
    <button data-theme="dark">üåô</button>
    <button data-theme="romantic">‚ù§Ô∏è</button>
  </div>

  <!-- Navigation -->
  <nav class="floating-nav">
    <a href="#memories">Memories</a>
    <a href="#music">Music</a>
    <a href="#reasons">Reasons</a>
  </nav>

  <main class="container">
    <h1 id="typed-text" class="fade-in"></h1>
    <button id="confetti-btn" class="fade-in">Click for Surprise!</button>

    <div class="two-column">
      <div class="left-column">
        <section class="gallery-section glass-panel fade-in" id="memories">
          <h2>Our Favorite Memories üì∏</h2>
          <div class="gallery-container">
            <div class="gallery">
             <img src="pictures/ffavorite.JPG" alt="Favorite memory photo" class="active" loading="eager" data-caption="Our favorite moment together" />
              <img src="pictures/kiss.JPG" alt="Kiss memory photo" loading="lazy" data-caption="Our first kiss" />
              <img src="pictures/loutraki.JPG" alt="Loutraki memory photo" loading="lazy" data-caption="Our trip to Loutraki" />
              <img src="pictures/neamakri.JPG" alt="Nea Makri memory photo" loading="lazy" data-caption="Our trip to Nea Makri" />
            </div>
            <button class="gallery-btn prev-btn" aria-label="Previous image">‚ùÆ</button>
            <button class="gallery-btn next-btn" aria-label="Next image">‚ùØ</button>
            <div class="dots-container" role="tablist"></div>
          </div>
        </section>
      </div>

      <div class="right-column">
        <section class="music-gift glass-panel fade-in" id="music">
          <h3>Your Special Album üé∂</h3>
          <div class="spotify-container">
            <iframe
              src="https://open.spotify.com/embed/album/5iIq470vW4rrsxq5ZRBo3Y?utm_source=generator"
              width="100%" height="352" frameborder="0"
              allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
              loading="lazy" style="border-radius:12px;">
            </iframe>
          </div>
        </section>
      </div>
    </div>

    <div class="reasons-widget glass-panel fade-in" id="reasons">
      <h2>Why You're Amazing</h2>
      <button id="reason-generator">Tell Me More</button>
      <div id="reason-display" class="reason-card"></div>
    </div>

    <div class="memories">
      <div class="memory-card fade-in">
        <div class="front">üåü Our First Photo</div>
        <div class="back"><img src="pictures/first.JPG" alt="First Photo" loading="lazy" /></div>
      </div>
      <div class="memory-card fade-in">
        <div class="front">üéâ Your Favorite Photo</div>
        <div class="back"><img src="pictures/kfavorite.JPG" alt="Favorite Photo" loading="lazy" /></div>
      </div>
    </div>

    <button id="secret" aria-label="Easter Egg">(Psst... click me)</button>
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // Preload next gallery image when current is loaded
      function preloadNextGalleryImage() {
        const galleryImages = document.querySelectorAll('.gallery img');
        const currentIndex = Array.from(galleryImages).findIndex(img => img.classList.contains('active'));
        const nextIndex = (currentIndex + 1) % galleryImages.length;
        
        if (!galleryImages[nextIndex].complete) {
          const img = new Image();
          img.src = galleryImages[nextIndex].src;
        }
      }

      // Listen for when the active image loads
      const activeGalleryImg = document.querySelector('.gallery img.active');
      if (activeGalleryImg) {
        if (activeGalleryImg.complete) {
          preloadNextGalleryImage();
        } else {
          activeGalleryImg.addEventListener('load', preloadNextGalleryImage);
        }
      }

      // Theme Switching - Enhanced Version
      const themeButtons = document.querySelectorAll('.theme-switcher button');
      
      // Apply saved theme or default to light
      const savedTheme = localStorage.getItem('theme') || 'light';
      document.body.className = savedTheme;
      
      // Highlight active theme button
      function highlightActiveTheme() {
        themeButtons.forEach(btn => {
          btn.style.transform = btn.dataset.theme === document.body.className ? 'scale(1.2)' : 'scale(1)';
          btn.style.boxShadow = btn.dataset.theme === document.body.className ? '0 0 0 2px var(--primary)' : 'var(--shadow-sm)';
        });
      }
      
      // Set up theme buttons
      themeButtons.forEach(button => {
        button.addEventListener('click', () => {
          const theme = button.dataset.theme;
          document.body.className = theme;
          localStorage.setItem('theme', theme);
          highlightActiveTheme();
          
          // Play a subtle sound on theme change (optional)
          const audio = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.mp3');
          audio.volume = 0.3;
          audio.play().catch(e => console.log("Audio play failed:", e));
        });
      });
      
      // Initialize button states
      highlightActiveTheme();

      try {
        // Hide loader when everything is loaded
        window.addEventListener('load', () => {
          document.querySelector('.loader').style.opacity = '0';
          setTimeout(() => {
            document.querySelector('.loader').style.display = 'none';
          }, 500);
          
          // Simulate loading progress
          const loadingBar = document.querySelector('.loading-bar');
          let progress = 0;
          const interval = setInterval(() => {
            progress += Math.random() * 10;
            loadingBar.style.width = `${progress}%`;
            if (progress >= 100) clearInterval(interval);
          }, 300);
        });

        // Typing Animation
        const typedTextEl = document.getElementById("typed-text");
        if (typedTextEl) {
          const text = "Happy Birthday, Kyriako! ‚ù§Ô∏è";
          let index = 0;
          typedTextEl.textContent = '';

          function typeWriter() {
            if (index < text.length) {
              typedTextEl.textContent += text.charAt(index);
              index++;
              setTimeout(typeWriter, 100);
            }
          }
          typeWriter();
        }

        // Confetti Button
        const confettiBtn = document.getElementById("confetti-btn");
        if (confettiBtn && typeof JSConfetti !== 'undefined') {
          const jsConfetti = new JSConfetti();

          confettiBtn.addEventListener("click", () => {
            jsConfetti.addConfetti({
              emojis: ['üéÇ', '‚ù§Ô∏è', 'üéâ', 'ü•≥'],
              confettiNumber: 150,
              confettiRadius: 6
            });
          });
        }

        // Flip Memory Cards with keyboard and 3D tilt support
        const memoryCards = document.querySelectorAll('.memory-card');
        memoryCards.forEach(card => {
          card.setAttribute('tabindex', '0');
          card.setAttribute('role', 'button');
          card.setAttribute('aria-pressed', 'false');

          card.addEventListener('click', () => {
            card.classList.toggle("flipped");
            toggleAriaPressed(card);
          });

          card.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              card.classList.toggle("flipped");
              toggleAriaPressed(card);
            }
          });

          // 3D Tilt Effect
          card.addEventListener('mousemove', (e) => {
            const xAxis = (window.innerWidth / 2 - e.pageX) / 15;
            const yAxis = (window.innerHeight / 2 - e.pageY) / 15;
            card.style.transform = `rotateY(${xAxis}deg) rotateX(${yAxis}deg)`;
          });
          
          card.addEventListener('mouseleave', () => {
            card.style.transform = 'rotateY(0deg) rotateX(0deg)';
          });
        });

        function toggleAriaPressed(card) {
          const pressed = card.getAttribute('aria-pressed') === 'true';
          card.setAttribute('aria-pressed', String(!pressed));
        }

        // Easter Egg - Arch Linux Edition
        const secret = document.getElementById("secret");
        if (secret) {
          secret.addEventListener("click", () => {
            const archMessages = [
              "sudo pacman -Syu my_heart\n> Dependency found: You",
              "error: could not lock db\n> Reason: Your smile holds the lock",
              "Kernel panic: Heart overload\n> Suggested fix: Hold Ctrl+Alt+Kyriako",
              "Arch Linux 100%\nYou 1000%",
              "systemctl start happiness.service\n> Activated by: Your presence",
              "git commit -m 'Best boyfriend ever'\n> [main 1337f1f] Kyriako approved",
              "ping 127.0.0.1\n> Reply from your heart: 64 bytes in 0.0001ms"
            ];
            const randomMsg = archMessages[Math.floor(Math.random() * archMessages.length)];
            
            // Format as terminal output with Arch colors
            alert(`$ ${randomMsg}\n\n(psst... happy birthday!)`); 
          });
        }

        // Gallery Functionality with Lightbox
        const gallery = document.querySelector('.gallery');
        const images = document.querySelectorAll('.gallery img');
        const prevBtn = document.querySelector('.prev-btn');
        const nextBtn = document.querySelector('.next-btn');
        const dotsContainer = document.querySelector('.dots-container');

        let currentIndex = 0;

        if (images.length && dotsContainer && prevBtn && nextBtn) {
          // Create dots
          images.forEach((_, i) => {
            const dot = document.createElement('div');
            dot.classList.add('dot');
            if (i === 0) dot.classList.add('active');
            dot.addEventListener('click', () => updateGallery(i));
            dotsContainer.appendChild(dot);
          });

          const dots = document.querySelectorAll('.dot');

          function updateGallery(index) {
            if (index < 0 || index >= images.length) return;
            images.forEach(img => img.classList.remove('active'));
            images[index].classList.add('active');
            
            dots.forEach(dot => dot.classList.remove('active'));
            dots[index].classList.add('active');
            
            currentIndex = index;

            // Preload next image when changing slides
            const nextIndex = (index + 1) % images.length;
            if (!images[nextIndex].complete) {
              const img = new Image();
              img.src = images[nextIndex].src;
            }
          }

          // Navigation
          prevBtn.addEventListener('click', () => {
            currentIndex = (currentIndex - 1 + images.length) % images.length;
            updateGallery(currentIndex);
          });

          nextBtn.addEventListener('click', () => {
            currentIndex = (currentIndex + 1) % images.length;
            updateGallery(currentIndex);
          });

          // Keyboard arrows
          document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') prevBtn.click();
            if (e.key === 'ArrowRight') nextBtn.click();
          });

          // Touch Swiping
          let touchStartX = 0;
          let touchEndX = 0;

          if (gallery) {
            gallery.addEventListener('touchstart', (e) => {
              touchStartX = e.changedTouches[0].screenX;
            });

            gallery.addEventListener('touchend', (e) => {
              touchEndX = e.changedTouches[0].screenX;
              handleSwipe();
            });
          }

          function handleSwipe() {
            if (touchEndX < touchStartX - 50) nextBtn.click(); // Swipe left
            if (touchEndX > touchStartX + 50) prevBtn.click(); // Swipe right
          }

          // Lightbox functionality
          images.forEach(img => {
            img.addEventListener('click', () => {
              const lightbox = document.createElement('div');
              lightbox.className = 'lightbox';
              lightbox.innerHTML = `
                <div class="lightbox-content">
                  <span class="close">&times;</span>
                  <img src="${img.src}" alt="${img.alt}">
                  <p class="caption">${img.dataset.caption || ''}</p>
                </div>
              `;
              document.body.appendChild(lightbox);
              
              lightbox.querySelector('.close').addEventListener('click', () => {
                lightbox.remove();
              });
              
              // Close when clicking outside
              lightbox.addEventListener('click', (e) => {
                if (e.target === lightbox) {
                  lightbox.remove();
                }
              });
            });
          });
        }

        // Reasons Widget Functionality
        const reasons = [
          "The way your eyes light up when you're happy",
          "How you always know how to make me smile",
          "Your incredible kindness to everyone around you",
          "The sound of your laugh that brightens my day",
          "How you remember little things about me that no one else does",
          "How you make even ordinary moments feel special",
          "Your strength and resilience that inspires me",
          "The way you understand me without words",
          "The way you listen to me like every word I say matters",
        ];

        const reasonBtn = document.getElementById("reason-generator");
        const reasonDisplay = document.getElementById("reason-display");

        if (reasonBtn && reasonDisplay) {
          reasonBtn.addEventListener("click", () => {
            // Reset animation
            reasonDisplay.classList.remove("show");
            void reasonDisplay.offsetWidth; // Trigger reflow
            
            // Get random reason
            const randomReason = reasons[Math.floor(Math.random() * reasons.length)];
            reasonDisplay.textContent = randomReason;
            
            // Show with animation
            setTimeout(() => {
              reasonDisplay.classList.add("show");
            }, 10);
          });
          
          // Show first reason automatically
          reasonDisplay.textContent = reasons[0];
          setTimeout(() => {
            reasonDisplay.classList.add("show");
          }, 1000);
        }

        // Theme Switching
        const themeButtons = document.querySelectorAll('.theme-switcher button');
        themeButtons.forEach(button => {
          button.addEventListener('click', () => {
            const theme = button.dataset.theme;
            document.body.className = theme;
            
            // Store preference
            localStorage.setItem('theme', theme);
          });
        });

        // Load saved theme
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.body.className = savedTheme;

        // Initialize particles
        function initParticles() {
          const container = document.querySelector('.particles-container');
          const particleCount = window.innerWidth < 768 ? 30 : 80;
          
          for (let i = 0; i < particleCount; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            
            // Random properties
            const size = Math.random() * 15 + 5;
            const posX = Math.random() * window.innerWidth;
            const posY = Math.random() * window.innerHeight;
            const delay = Math.random() * 5;
            const duration = Math.random() * 15 + 10;
            const color = `hsla(${Math.random() * 360}, 100%, 75%, 0.7)`;
            
            particle.style.cssText = `
              width: ${size}px;
              height: ${size}px;
              left: ${posX}px;
              top: ${posY}px;
              background: ${color};
              animation-delay: ${delay}s;
              animation-duration: ${duration}s;
            `;
            
            container.appendChild(particle);
          }
        }

        initParticles();

        // Add intersection observer for scroll animations
        const scrollElements = document.querySelectorAll('[data-scroll]');
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.setAttribute('data-scroll', 'in');
            }
          });
        }, { threshold: 0.1 });

        scrollElements.forEach(el => observer.observe(el));

      } catch (error) {
        console.error("Something went wrong:", error);
        const errorEl = document.createElement('div');
        errorEl.className = 'error-message';
        errorEl.textContent = "Whoops! A small error, but your birthday sparkle shines bright ‚ú®";
        document.body.prepend(errorEl);
      }
    });
  </script>
</body>
</html>
